# Installation
**`Notice`**

TDengine uses the Go connector to perform data writing and querying in the 
TSBS test. The installation process relies on the C client library. 
Therefore, before compiling TSBS, the Taos client must be installed to 
provide the necessary library files. For instructions on how to install the 
Taos client and server, refer to the [TDengine documentation](https://docs.tdengine.com/get-started/deploy-from-package/).

# TSBS Supplemental Guide: TDengine

TDengine is an open-source time-series database with high performance, scalability, and SQL support. 
This supplemental guide explains how
the data generated for TSBS is stored, additional flags available when
using the data importer (`tsbs_load_tdenginestmt2` or `tsbs_load_tdengine`), and additional flags
available for the query runner (`tsbs_run_queries_tdengine`). 

**This guide should be read *after* the main README.**

---
## Generate Data

TDengine supports two different write modes for data ingestion: SQL mode and `stmt2` mode. Each mode corresponds to a specific data format generated by `tsbs_generate_data`. It is important to choose the appropriate mode and data format based on your use case.

### Data Format

The data format generated by `tsbs_generate_data` depends on the `--format` parameter:

#### 1. SQL mode: **`--format="TDengine"`**:
Data is serialized in a "pseudo-CSV" format. This format is based on the SQL way of inserting. Each reading consists of a row, where the first item represents the operation type, indicated by 1, 2, or 3.
- **1**: Insert data. The format is:
    - `1,common table name,field count,insert data`
- **2**: Create a super table. The format is:
    - `2,super table name,common table name,create table SQL`
- **3**: Create a regular table. The format is:
    - `3,super table name,common table name,create table SQL`
* Example for the `cpu-only` use case:
```text
2,cpu,host_0,create table cpu (ts timestamp,usage_user bigint,usage_system bigint,usage_idle bigint,usage_nice bigint,usage_iowait bigint,usage_irq bigint,usage_softirq bigint,usage_steal bigint,usage_guest bigint,usage_guest_nice bigint) tags (hostname binary(30),region binary(30),datacenter binary(30),rack binary(30),os binary(30),arch binary(30),team binary(30),service binary(30),service_version binary(30),service_environment binary(30))
3,cpu,host_0,create table host_0 using cpu (hostname,region,datacenter,rack,os,arch,team,service,service_version,service_environment) tags ('host_0','eu-central-1','eu-central-1a','6','Ubuntu15.10','x86','SF','19','1','test')
1,host_0,10,(1451606400000,58,2,24,61,22,63,6,44,80,38)
```

#### 2. `stmt2` mode: **`--format="TDengineStmt2"`**:

Data is serialized in a binary format optimized for the stmt2 binding method.
This format is more efficient for large-scale data ingestion and is recommended for high-performance scenarios.

* Example:
The binary format cannot be directly visualized as text but is designed for efficient parsing and insertion using tsbs_load_tdenginestmt2.

## Load Data
The `tsbs_load_tdengine` and `tsbs_load_tdenginestmt2` tools are used for importing data into TDengine, but they differ in their data insertion methods:

- **`tsbs_load_tdengine`**: Uses SQL string concatenation to insert data. This method is straightforward and easy to understand but may not achieve the highest performance.
- **`tsbs_load_tdenginestmt2`**: Uses the `stmt2` binding method for data insertion. This approach is more efficient and faster, especially for large-scale data ingestion.


## `tsbs_load_tdengine` and `tsbs_load_tdenginestmt2` Additional Flags

### Connection-Related Flags

#### `-user` (type: `string`, default: `root`)

Specifies the username for connecting to TDengine.

#### `-pass` (type: `string`, default: `taosdata`)

Specifies the password for the user connecting to TDengine.

#### `-host` (type: `string`)

Specifies the hostname of the TDengine server.

#### `-port` (type: `int`, default: `6030`)

Specifies the port of the TDengine server.

### TDengine Database-Related Flags

TDengine provides several parameters for creating a database. See the [TDengine documentation][conn-str] for more details.

#### `-buffer` (type: `int`, default: `256`)

Specifies the size (in MB) of the write buffer for each vnode. Enter a value between 3 and 16384.

#### `-pages` (type: `int`, default: `256`)

Specifies the number of pages in the metadata storage engine cache on each vnode. Enter a value greater than or equal to 64.

#### `-stt_trigger` (type: `int`, default: `1`)

Specifies the number of file merges triggered by flushed files. The value ranges from 1 to 16.

#### `-wal_level` (type: `int`, default: `1`)

Specifies whether fsync is enabled for the Write-Ahead Log (WAL). The default value is 1.

- **1**: WAL is enabled, but fsync is disabled.
- **2**: Both WAL and fsync are enabled.

#### `-wal_fsync_period` (type: `int`, default: `3000`)

Specifies the interval (in milliseconds) at which data is written from the WAL to disk. This parameter is effective only when the WAL parameter is set to 2. Enter a value between 0 and 180000.

#### `-vgroups` (type: `int`, default: `2`)

Specifies the initial number of vgroups when a database is created. The value ranges from 0 to 4096.

#### `-db-name` (type: `string`, default: `benchmark`)

Specifies the name of the database.

### Miscellaneous Flags

#### `-hash-workers` (type: `boolean`, default: `false`)

Determines whether to consistently hash data across multiple insert workers based on the value of the primary (first) tag. For datasets with a large number of devices, this option helps improve data locality on disk, which can lead to better query performance. For datasets with a small number of devices, this option is typically unnecessary.

[conn-str]: https://docs.tdengine.com/tdengine-reference/sql-manual/manage-databases/

---

## `tsbs_run_queries_tdengine` Additional Flags

### Connection-Related Flags

#### `-user` (type: `string`, default: `root`)

Specifies the username for connecting to TDengine.

#### `-pass` (type: `string`, default: `taosdata`)

Specifies the password for the user connecting to TDengine.

#### `-host` (type: `string`)

Specifies the hostname of the TDengine server.

#### `-port` (type: `int`, default: `6030`)

Specifies the port of the TDengine server.

